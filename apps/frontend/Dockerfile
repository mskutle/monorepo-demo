FROM mhart/alpine-node:13.1.0

ENV CI=true

# This one will copy contents of TEMP directory generated by
# common/scripts/prepare-files-for-dependencies-docker.sh script into the docker container
# COPY ./TEMP .
WORKDIR /app
COPY . /app/
RUN node ./common/scripts/install-run-rush.js install -p

# Here we copy the rest of the files, like source code etc.
# COPY . .

RUN node ./common/scripts/install-run-rush.js build
RUN node ./common/scripts/install-run-rush.js deploy
# RUN chmod +rx ./common/deploy/*
# RUN ls -ltra ./common/deploy/apps/time
# RUN pwd
WORKDIR /app/common/deploy/apps/frontend/
# RUN pwd
RUN ls -ltra
RUN rushx build
RUN rushx start